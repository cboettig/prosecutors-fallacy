%        File: boettiger.tex
%     Created: Mon Oct 10 04:00 PM 2011 P
% Last Change: Mon Oct 10 04:00 PM 2011 P
%%% PNAStmpl.tex
%% Template file to use for PNAS articles prepared in LaTeX
%% Version: Apr 14, 2008


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% BASIC CLASS FILE 
%% PNAStwo for two column articles is called by default.
%% Uncomment PNASone for single column articles. One column class
%% and style files are available upon request from pnas@nas.edu.
%% (uncomment means get rid of the '%' in front of the command)

%\documentclass{pnasone}
\documentclass{pnastwo}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Changing position of text on physical page:
%% Since not all printers position
%% the printed page in the same place on the physical page,
%% you can change the position yourself here, if you need to:

% \advance\voffset -.5in % Minus dimension will raise the printed page on the 
                         %  physical page; positive dimension will lower it.

                         %% You may set the dimension to the size that you need.

                         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                         %% OPTIONAL GRAPHICS STYLE FILE

                         %% Requires graphics style file (graphicx.sty), used for inserting
                         %% .eps files into LaTeX articles.
                         %% Note that inclusion of .eps files is for your reference only;
                         %% when submitting to PNAS please submit figures separately.

                         %% Type into the square brackets the name of the driver program 
                         %% that you are using. If you don't know, try dvips, which is the
                         %% most common PC driver, or textures for the Mac. These are the options:

                         % [dvips], [xdvi], [dvipdf], [dvipdfm], [dvipdfmx], [pdftex], [dvipsone],
                         % [dviwindo], [emtex], [dviwin], [pctexps], [pctexwin], [pctexhp], [pctex32],
                         % [truetex], [tcidvi], [vtex], [oztex], [textures], [xetex]

                         \usepackage[pdftex]{graphicx}

                         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                         %% OPTIONAL POSTSCRIPT FONT FILES

                         %% PostScript font files: You may need to edit the PNASoneF.sty
                         %% or PNAStwoF.sty file to make the font names match those on your system. 
                         %% Alternatively, you can leave the font style file commands commented out
                         %% and typeset your article using the default Computer Modern 
                         %% fonts (recommended). If accepted, your article will be typeset
                         %% at PNAS using PostScript fonts.


                         % Choose PNASoneF for one column; PNAStwoF for two column:
                         %\usepackage{PNASoneF}
                         %\usepackage{pnastwof}

                         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                         %% ADDITIONAL OPTIONAL STYLE FILES

                         %% The AMS math files are commonly used to gain access to useful features
                         %% like extended math fonts and math commands.

                         \usepackage{amssymb,amsfonts,amsmath}
                         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                         %% OPTIONAL MACRO FILES
                         %% Insert self-defined macros here.
                         %% \newcommand definitions are recommended; \def definitions are supported

                         %\newcommand{\mfrac}[2]{\frac{\displaystyle #1}{\displaystyle #2}}
                         %\def\s{\sigma}

                         \newcommand{\ud}{\mathrm{d}}

                         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                         %% Don't type in anything in the following section:
                         %%%%%%%%%%%%
                         %% For PNAS Only:
                         \contributor{Submitted to Proceedings
                         of the National Academy of Sciences of the United States of America}
                         \url{www.pnas.org/cgi/doi/10.1073/pnas.0709640104}
                         \copyrightyear{2008}
                         \issuedate{Issue Date}
                         \volume{Volume}
                         \issuenumber{Issue Number}
                         %%%%%%%%%%%%

                         \begin{document}

                         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


                         %% For titles, only capitalize the first letter
                         %% \title{Almost sharp fronts for the surface quasi-geostrophic equation}

                         \title{Quantifying Limits to Detection of Early Warning for Critical Transitions}


                         %% Enter authors via the \author command.  
                         %% Use \affil to define affiliations.
                         %% (Leave no spaces between author name and \affil command)

                         %% Note that the \thanks{} command has been disabled in favor of
                         %% a generic, reserved space for PNAS publication footnotes.

                         %% \author{<author name>
                         %% \affil{<number>}{<Institution>}} One number for each institution.
                         %% The same number should be used for authors that
                         %% are affiliated with the same institution, after the first time
                         %% only the number is needed, ie, \affil{number}{text}, \affil{number}{}
                         %% Then, before last author ...
                         %% \and
                         %% \author{<author name>
                         %% \affil{<number>}{}}

                         %% For example, assuming Garcia and Sonnery are both affiliated with
                         %% Universidad de Murcia:
                         %% \author{Roberta Graff\affil{1}{University of Cambridge, Cambridge,
                         %% United Kingdom},
                         %% Javier de Ruiz Garcia\affil{2}{Universidad de Murcia, Bioquimica y Biologia
                         %% Molecular, Murcia, Spain}, \and Franklin Sonnery\affil{2}{}}

                         \author{Carl Boettiger\affil{1}{Center for Population Biology, University of California, Davis}, 
                         Alan Hastings\affil{2}{Department of Environmental Science and Policy, University of California, Davis} }

                         \contributor{Submitted to Proceedings of the National Academy of Sciences
                         of the United States of America}

                         %% The \maketitle command is necessary to build the title page.
                         \maketitle

                         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                         \begin{article}

                           \begin{abstract} 

Catastrophic regime shifts in complex natural systems may be averted through advanced detection. 
Recent work has provided a proof-of-principle that many systems approaching a catastrophic transition look different 
through the lens of early warning indicators such as rising variance or increased return times.  
Without the benefit of hindsight of a collapse, 
applications of these approaches must quantify how reliable different indicators are in avoiding false alarms, 
and how sensitive they are to missing subtle warning signs.  
We propose an approach which quantifies this trade-off between reliability and sensitivity, 
allows comparisons between different indicators, 
and estimates what data are necessary to achieve a desired error rate.  
We also introduce a likelihood-based indicator that is more sensitive than previously proposed summary statistics.

                           \end{abstract}


                             %% When adding keywords, separate each term with a straight line: |
                             \keywords{ early warning signals | tipping point | alternative stable states | likelihood methods }

                             %% Optional for entering abbreviations, separate the abbreviation from
                             %% its definition with a comma, separate each pair with a semicolon:
                             %% for example:
                             %% \abbreviations{SAM, self-assembled monolayer; OTS,
                             %% octadecyltrichlorosilane}

                             % \abbreviations{}

                             %% The first letter of the article should be drop cap: \dropcap{}
                             %\dropcap{I}n this article we study the evolution of ''almost-sharp'' fronts

                             %% Enter the text of your article beginning here and ending before
                             %% \begin{acknowledgements}
                             %% Section head commands for your reference:
                             %% \section{}
                             %% \subsection{}
                             %% \subsubsection{}

\dropcap{T}here is an increasing recognition of the importance of regime shifts or critical transitions at a variety of scales in ecological systems~\cite{Holling1973, Wissel1984, Scheffer2001, Scheffer2009, Drake2010, Carpenter2011}⁠. 
Many important ecosystems may currently be threatened with collapse, including corals~\cite{Bellwood2004}, fisheries~\cite{Berkes2006}⁠, lakes~\cite{Carpenter2011} , and semi-arid ecosystems~\cite{Kefi2007}⁠. 
Given the potential impact of  these shifts on the sustainable delivery of ecosystem services
and the idea that management responses would be needed either to avoid an undesirable shift or else to adapt to novel conditions,
it is important to develop the ability to predict impending regime shifts based on early warning signs. 
With a good model of the system, system-specific approaches could be useful~\cite{Lenton2009}.
but in cases where good models are not available general approaches are needed~\cite{Scheffer2009}⁠.
We focus on the common scenario of a gradual environmental change yielding a sudden shift or bifurcation in a system~\cite{Scheffer2001, Scheffer2009}.
% hmm, not environmental examples\dots ⁠
We describe a novel statistical approach that is appropriate for the goal of informing management.  

Though previous research has identified patterns such as increasing variance or autocorrelation in time-series approaching a critical transition,
there has been no method for forecasting the probability of a collapse from a natural system.
As real-world applications of early warning signals will not be able to point to the same differences between controlled and
manipulated systems that have been demonstrated in experimental studies of early warning~\cite{Drake2010, Carpenter2011}⁠.
While the number of potential patterns grows steadily~\cite{Carpenter2006, Dakos2008, Guttal2008, Guttal2008a, Dakos2011}, % add spectral methods
there are few examples that statistically quantify the patterns~\cite{Dakos2008, Dakos2011},⁠
and fewer still that determine the distribution of that quantity in the event that the system is not approaching a transition --
the reliability or false alarm rate~\cite{Dakos2008}⁠. 
None have considered the distribution of such a statistic in the event that a system is approaching a transition -- 
the sensitivity to avoid missed detection.  
We need to quantify such uncertainty/error rates to compare between possible methods~\cite{Contamin2009}
and address the continual concern about how much data is necessary⁠ for robust detection~\cite{Scheffer2001, Dakos2008, Carpenter2011, Scheffer2010, Inman2011}.  

Detection of impending transitions is not just a scientific question and the goal should not solely be to detect with a 5\% chance of a false positive,
and a higher false alarm rate may well be  worth a smaller chance of  missing a catastrophic shift. 
There is an obvious trade-off between the frequency with which a given approach will experience a false alarm and
with which it will fail to provide any advanced warning. 
Choosing the appropriate trade off requires knowledge of the likelihood of both kinds of error.
In this paper, we
(a) present the first measurements of reliability and sensitivity for early-warning indicators, 
(b) we use this method to estimate the amount of data required to achieve a given level of confidence,  
(c) we show where existing methods have performed little better than chance due to a lack of sufficient data or the use of an insensitive method 
(d) we introduce a new indicator based on likelihood which substantially out-performs the existing methods.     

We illustrate the trade-off between false alarms and failed detection using receiver-operating characteristic (ROC) curves first developed in signal-processing literature~\cite{Green1989, Keller2009}⁠. 
The curves represent the corresponding false alarm rate at any detection sensitivity (true positive rate), Fig 1.
The closer these distributions are to one-another, the more severe the trade-off.  
If the distributions overlap exactly, the ROC curve has a constant slope of unity.  
The ROC curve demonstrates this trade-off between accuracy and sensitivity.  
Different early-warning indicators will vary in their sensitivity to detect differences between stable systems and those approaching a critical transition, making the ROC curves a natural way to compare their performance.  
Since the shape of the curve will also depend on the duration and frequency of the time-series observations,
we can use these curves to illustrate by how much a given increase in sampling effort can decrease the rate of false alarms or failed detections.  
The area under the ROC curve provides a summary of how well the method compares to a random guess --
an area of 0.5 corresponding to perfectly overlapping distributions is performing no better than chance, while a statistic with area of unity always distinguishes correctly between stable systems and those approaching a transition. 

To generate ROC curves for common early warning indicators such as 
increases in autocorrelation, variance, and skew, 
we must quantify the increase and generate the expected distributions of the focal statistic.  
While the existing literature frequently presents only a 
% e.g. Drake \& Griffen use any two-sigma deviation as indicative, yet any sufficiently sampled null process will produce a positive warning,  
% so this is not a reasonable statistical characterization
visual or heuristic measure of increase\footnote{That is, do not provide $p$-values or a statistic for which they could be generated.} in early-warning indicators~\cite{Scheffer2009, Drake2010, Carpenter2011, Carpenter2006}, 
we rely on the few examples that quantify an increasing trend using Kendall's $\tau$ correlation statistic~\cite{Dakos2008, Dakos2011, Dakos2009}.
Values of $\tau$ near unity indicate a strongly increasing trend in the warning indicator --
suggestive of an approaching transition, while values near zero suggest a lack of a trend -- characteristic of stable systems.
In principle, other quantifications of increasing variance, autocorrelation, etc,
may perform better than $\tau$ and could be analyzed just as well in this framework. 
While we use this established metric of increase, we also introduce a novel warning indicator
that is not based on the gradual increase of a summary statistic but on likelihood comparisons.  

Having identified an indicator statistic,
we must be able to generate its distribution under both the scenario of a stable system and 
one approaching a transition before we can compute the ROC curve.
We fit general stochastic models representing common bifurcations
(e.g. saddle-node~\cite{Scheffer2009, Guttal2008a, VanNes2007, Biggs2009} and transcritical bifurcations~\cite{Drake2010} )
for both scenarios to the data by maximum likelihood, and then simulate 500 replicate data sets under each⁠. 
By estimating the statistic (e.g. $\tau$) on each replicate we generate distributions such as depicted in Fig. 1 and compute ROC curves (see Methods).
Our approach provides a novel method for comparing alternatives by their likelihood ratio statistic~\cite{Cox1961}⁠ instead of $\tau$,
which provides a more direct and more powerful test than detecting an increase in summary statistics.
As these methods are computationally demanding, we provide a multi-processor enabled R package to assist with the analysis. 

\section{Examples}

We illustrate this analysis of uncertainty in early warning indicators in simulated and empirical data sets (Fig. 2). 
We explore two empirical examples:
deuterium concentrations (Fig. 2c) provide an observational dataset previously cited as an early warning signal of a critical transition in glaciation~\cite{Dakos2008},
and \emph{Daphnia magna} concentrations (Fig. 2d) manipulated in a chemostat towards a critical transition~\cite{Drake2010}.  
For comparison, we include an individual-based simulation of a system approaching a saddle-node bifurcation due to environmental deterioration,
and the same system in a constant environment. 
The challenge of accurate detection is clearly illustrated by comparing the patterns for a system approaching transition (b-d) 
against the simulation of a stable system, in which chance fluctuations give the appearance of steadily rising autocorrelation. 
While such a pattern will fade in a longer or more frequently sampled time-series of the same system, 
we need a way to identify such cases where we lack the data to trust the pattern.  

The ROC curves for these data (Fig. 3) show that the summary-statistic based indicators 
frequently lack the sensitivity to distinguish reliably between observed patterns from a stable or unstable system.  
The large correlations observed in the empirical examples (Fig. 2) are not uncommon in stable systems.  
The best-performing summary statistic would, at a 5\% false positive rate, have a 10\% chance of catching a true positive 
in both the Daphnia and Glaciation data set.  
Meanwhile, our likelihood-based approach performs substantially better, 
having respectively a 30\% in Daphnia and 100\% chance in Glaciation set of catching a true positive at a 5\% false positive rate. 
Because we have the entire ROC curve, we are not restricted to an evaluation at a fixed false-positive rate such as 5\%, 
but can accept more false-positives to avoid missing as many impending catastrophes.  
This is particularly valuable in the context of critical transitions, 
where data are often limited and the consequences of missed detection can be far more severe than false alarms.  

%%%%%%% Converting from power to detection %%%%%%%%%%%%

\section{Discussion}
A pressing question in the application of early warning signals is quantifying when the data are sufficient for detection to be reliable~\cite{Scheffer2009, Scheffer2010, Inman2011}. 
Our approach provides a natural way to address this challenge by estimating the ROC curve under differing data sampling efforts
for each of the indicators (Fig 4). 
Using our generic models estimated from the original data as in Fig. 3, 
we generate the corresponding distributions by simulating under the models as before, 
but with more or less frequent sampling to illustrate how our ability to detect an approaching transition 
would be hampered or improved with more or less data.  
While all methods improve as the number of data points increase, 
the coefficient of variation and the variance show more substantial improvement than autocorrelation, 
as expected~\cite{Carpenter2011};⁠
skew performs little better than chance, and likelihood is consistently the most reliable and sensitive (Fig. 4). 

%% Threshold
%% Imagine a missed detection of no more than 10% is acceptable.  


Moreover, this illustrates that the summary statistics are very unreliable indicators. 
A low false alarm rate is only achieved by poor sensitivity; 
or conversely sensitivity it only achieved with a high rate of false alarms.  
This is under assumptions that are highly favorable to these statistics, corresponding directly to the process assumptions.  
The reason for this comes largely from the difficulty in quantifying an increase without a baseline -- 
the distribution of tau under the null model covers almost the entire range.  %Ref FIGURE


Our approach of estimating uncertainty and using the likelihood indicator is neither more nor less general than the other indicators we discuss.  
All rely on the assumption of an underlying bifurcation driven by the principle eigenvalue passing through zero.\footnote{
Skew, a higher order term, has additional assumption about the asymmetry,
and is thus generically less powerful than signals on the lower order moments.} 
These methods are robust to the assumptions of Gaussian noise and linearity of the model,
as illustrated by the fit to the simulated data, 
which instead comes from a nonlinear, discrete-state Markov process (see Appendix).  
The likelihood approach still performs the best on this data, hence it is not less general.  

When the underlying bifurcation model does not apply, neither summary statistics nor our model-based description will be useful.  

We stress that all of the early warning signals approaches must only be applied when the underlying assumptions can be justified.  
The summary statistics such as variance or autocorrelation are no more general than our explicit models, % wow
and systems that do not correspond to these bifurcations can exhibit sudden transitions without any warning~\cite{Hastings2010}.
For instance, bifurcations resulting in sudden transitions have been observed in ecological models in which 
the variance actually deceases as a sudden shift approaches~\cite{Schreiber2003, Schreiber2008}.  

Meanwhile, if our knowledge of the system gives reason to be concerned that it may experience a saddle-node or transcritical bifurcation,

If we can use increasing variance as an indicator, than we can use the approach described here to quantify uncertainty.  

Although not all sudden collapses correspond to our model assumptions,
including dynamical systems where the variance actually decreases as a sudden shift approaches,⁠
using our model-driven approach may make it easier to identify dynamics that do not correspond with the underlying assumptions.  
Including measurement error and focusing on such different classes of dynamics are other complications we do not address at this time, 
but would be amenable to the approach used here. 

The approach presented here offer a best-case scenario for these warning signals,
illustrating that substantial uncertainty can remain despite the appearance of a positive increase.
Our results highlight the need to quantify uncertainty in the application of early warning signals,
and suggest that a hypothesis testing approach may be too restrictive a framework for that purpose.
Using the ROC curve, we obtain a more general picture of the trade-off between false alarms and failed detections
than can be provided by a significance test at a fixed false-alarm rate.  
The curve can guide the choice of threshold used to indicate a warning signal on a case-by-case basis.  


The conclusion is not simply that likelihood approaches are more reliable, 
but rather more broadly that warning signals should consider
the inherent trade-off between sensitivity and accuracy,
and must quantify how this trade-off depends on both the indicators used and the data available.  
The approach developed here estimates the risk of both failed detection and false alarms;
concepts which are critical to prediction-based management.  
Using the methods we have outlined when designing early warning strategies for natural systems
can ensure that data collection has adequate power to offer a reasonable chance of detection. 


                             %% == end of paper:

                             %% Optional Materials and Methods Section
                             %% The Materials and Methods section header will be added automatically.

                             %% Enter any subheads and the Materials and Methods text below.
                             \begin{materials}
                               \subsection{Methods}\label{methods}
For each dataset, parameters are estimated by maximum likelihood for a stable model
and a model of a system approaching a critical transition (Appendix).
The models are stochastic differential equations (SDEs)
that can be used to simulate data under the same sampling regime as the original data, 
or at any specified set of time points.
Distributions are determined by a parametric bootstrap:
500 replicate datasets are simulated under both stable and deteriorating stability model (for each dataset).
For each replicate, the summary statistics (variance, autocorrelation, skew, and coefficient of variation)
were computed over a sliding window equal to half the observed time (other window sizes had worse performance, see R package), 
and a Kendall's correlation test applied to estimate correlation coefficient $\tau$.
The estimates of $\tau$ under the replicate simulations from the stable system
and the estimates under the deteriorating stability system
make up the two distributions which are integrated at a sliding threshold to create the ROC curves, as illustrated in Fig 1. 

The likelihood test is performed as in the parametric bootstrap; 
but each simulated replicate is refit to both stable and deteriorating models to generate a difference in likelihood scores~\cite{Cox1961}.
Refitting the models on each replicate, 
rather merely computing the likelihood under the original estimates,
makes this much more computationally intensive than the summary statistic calculation but is essential to the power of this approach~\cite{Huelsenbeck1996}.

When replicates are created by simulation under the estimated models,
we record data at the same time intervals observed in the original data (as in Fig. 3, main text). 
It is straight forward to allow this interval to be different,
representing the effect of increased or decreased sampling effort on the reliability-sensitivity trade-off in the ROC curve, Fig 4.

The source code for implementing each of the analyses and generating the plots presented is provided as an R package, \verb|warningsignals|. 


                               \subsection{Data sets}
The simulated data sets are produced with 40 data points
sampled evenly sampled over a time interval (0,100) using an individual-based model of a system containing a saddle-node bifurcation, Eq~\eqref{master}.
The data was then fit to the LSN model, Eq~\eqref{LSN}, to compute the ROC curves. 

The Glaciation data is accessible from NOAA~\cite{Petit1999}.
The data is preprocessed by linear interpolation and de-trending by Gaussian kernel smoothing 
to be as consistent as possible with the original analysis from Dakos \emph{et al.}~\cite{Dakos2008},
analyzing the third glaciation event, consisting of 121 sample points. 
The match is not exact since estimates the de-trending window size manually,
but the estimated correlations in the first-order auto-regression coefficients are in close agreement with that analysis. 
De-trending is intended to make the data consistent with the assumptions of the warning signal detection~\cite{Dakos2008}, 
which did not apply to the other data sets~\cite{Drake2010}.  

The \emph{Daphnia} example comes from the chemostat ``H6'' in the experiments of Drake \& Griffen~\cite{Drake2010}. 
This individual replicates was chosen as an example of a single replicate 
that showed a statistically significant correlation in variance over window of time where critical slowing down was expected. 
Further empirical examples that have been previously investigated for early warning signs are also analyzed under our approach in SI Text.  

All data and code for simulations and data processing are found in the R package.  

                             \end{materials}

                             %% Optional Appendix or Appendices
                             \appendix 
                             \subsection{Models}
The detection of early warning is based on a \emph{local} theory,
predicting changes in the dynamics near the current attractor.
Consequently, it is as unnecessary as it is impossible to estimate a fully nonlinear model,
but only the linearized model near the bifurcation.

\subsubsection{Saddle-node bifurcation}
Many models with alternative stable states considered in ecological systems can exhibit this kind of bifurcation.
The individual-based simulation follows the master equation  
\begin{align}
  P(n,t) &= b_{n-1} p_{n-1} + d_{n+1}p_{n+1} - (b_n+d_n)p_n  \label{master} \\ 
  b_n &= \frac{e K x^2}{X^2 + h_t^2} \nonumber \\ 
  d_n &= e X_t - a_t   \nonumber
\end{align}
This model can experience a saddle-node bifurcation through increased mortality by increasing either $e$ or $a$. 
The SDE approximation holds for reasonable population sizes:
\begin{equation}
dX_t = \left( \frac{e K x^2}{X^2 + h_t^2} - e X_t - a_t\right) dt + \sigma \sqrt{ \frac{e K x^2}{X^2 + h_t^2} + e X_t + a_t} dB_t \label{ass}
\end{equation}
This parameterization is only an example, of course many others are possible~\cite{Scheffer2009, Scheffer2001, Strogatz2001a, Guckenheimer1983}. 
Under appropriate transformation, all can be written in the same normal form for he saddle-node bifurcation,
\begin{equation}
\frac{\ud x}{\ud t} = r_t- x^2.
\label{saddle-node}
\end{equation}
While in principle this model could be estimated directly from the data,
if all observations have been prior to the crash (\emph{i.e.} near the desirable equilibrium)
we have no data which is informative about the nonlinearity and such estimates will be unreliable.  
Fortunately the theory of early warning signals is a \emph{local} one, 
and we can linearize around the equilibrium to obtain a model we can estimate both more easily and more accurately.  

Transforming the canonical form to allow for an arbitrary mean $\theta$,
the bifurcation looks like $ dx/dt = r_t- (\theta-x)^2 $, with fixed point $\hat x = \sqrt{r_t} +\theta =: \phi$,
which gives the model we refer to as the Linearized Saddle Node, LSN: 
\begin{equation}
\ud X = 2\sqrt{ r_t } (\phi - X_t)\ud t + \sigma\sqrt{\phi } \ud B_t. \label{LSN}
\end{equation}

\subsubsection{Transcritical Bifurcation}
Drake \& Griffen induce a transcritical bifurcation in laboratory populations of \emph{Daphnia magna} to test early warning signals~\cite{Drake2010}.  
This bifurcation also arises in many common models.  For example, the stochastic Levin's model~\cite{Levins1969} (a logistic model),
\begin{equation}
\ud X_t = \left( c_t X_t (1-X_t/K) - e_t X_t \right) \ud t + \sigma \sqrt{\frac{e_t}{c_t}} \ud B_t \label{levins},
\end{equation}
where $X_t$ is the number of occupied patches of some total number $K$, $c_t$ is a (time-dependent)
colonization rate and $e_t$ an extinction rate (both scaled by the number of patches $K$).  
The model contains a transcritical bifurcation when $c_t < e_t$.  The normal form of the bifurcation is
\begin{equation}
\frac{\ud x}{\ud t} = r_t x - x^2 
\label{transcritical}
\end{equation}
%We can rewrite the deterministic part of the Levins model, Eq~\eqref{levins} in normal form without loss of generality by taking $r_t = 1 - e_t/c_t$.  
%We can linearize around the stable equilibrium value $\hat x(t) = 1 - e_t/c_t = r_t$, 
%\begin{align}
%\dot x &=  f(x) \approx f'(x)|_{\hat x} (x - \hat x) + \ldots, \nonumber \\
% &= (r_t - 2 x_t|_{x=\hat x}) (x - \hat x), \nonumber\\
% &= r_t(r_t - x). \nonumber
%\end{align}
%Note the equilibrium time dependence arises not from the internal dynamics but from the changing parameter values.
We can express the linearized stochastic dynamics then by the time dependent mean-reverting process. 
We refer to this model as the linearized transcritical bifurcation, LTC.  
\begin{equation}
\ud X_t = r_t (r_t - X_t/K) \ud t + \sigma \sqrt{1+r_t} \ud B_t \label{LTC}
\end{equation}

%The pattern of the saddle-node differs from that of the transcritical in the square-root dependence on the bifurcation parameter.
Note that the transcritical bifurcation involves a gradual decline towards zero,
whereas the saddle-node bifurcation involves a sudden transition from a non-trivial equilibrium point.
Thus saddle-node bifurcations are the more typical focus of early warning efforts, even though both exhibit the phenomenon of critical slowing down.
%We include this example for the \emph{Daphnia} data~\cite{Drake2010}, showing how our approach could be applied in that scenario.  

%Many models may differ substantially from~\eqref{ass} and~\eqref{levins} and yet correspond to the linearizations illustrated here.  
%The linearizations have thus been constructed with enough free parameters to capture the gross features of the system,
%(scaling the equilibrium position, variance, and timescale) while corresponding to the approximations of normal forms of the bifurcations.  
%Despite this, there are severe limitations in formulating even a linear approximation without ample knowledge of the system. 
Likelihood calculations also require specifying the rate of change of $r_t$, 
which we take to first order as
\begin{equation}
r_t = r_0 - m t.
\label{R_t}
\end{equation}
Detecting accelerating or otherwise nonlinear approaches to the bifurcation will generally require more power. 
%\subsubsection{Stable Model}
When the system is stable, $r_t$ is constant and both models~\eqref{LSN} and~\eqref{LTC} reduce to a simple Ornstein-Uhlenbeck process, 
\begin{equation}
\ud X_t = r (\theta - X_t) \ud t + \sigma \ud B_t \label{OU}
\end{equation}
This is the continuous time analog of the first-order autoregressive model considered as a null model elsewhere (\emph{e.g.} \cite{Dakos2008, Guttal2008a}). 

\subsection{Likelihood calculations}\label{likelihood}
The probability $P(X|M)$ of the data $X$ given the model $M$ is the product of the probability of observing each point in the time series given the previous point and the length of the interval,  
\begin{equation}
\log P(X | M)=  \sum_i \log P(x_i | x_{i-1}, t_i)
\end{equation}
For~\eqref{LSN},~\eqref{LTC} or~\eqref{OU} it is sufficient~\cite{Gardiner2009} to solve the moment equations for mean and variance respectively:
\begin{align}
 \frac{\ud }{\ud t} E(x| M)&=  f(x) \\
\frac{\ud}{\ud t} V(x| M) &=  -\partial_x f(x) V(x|M) + g(x)^2 
  \label{general_moments}
\end{align}

For the OU process, we can solve this in closed form, 
\begin{align}
  E(x_i| M = \text{OU}) &= X_{i-1} e^{-r t_i} \theta \left(1 - e^{-rt_i} \right) \\
V(x_i| M = \text{OU}) &= \frac{\sigma^2}{2 r} \left(1 - e^{-2 r t_i} \right)
\label{OUsoln}
\end{align}

For the time dependent models, we have analytic forms only for the dynamical equations of these moments from equation~\eqref{general_moments}, which we must integrate numerically over each time interval. For the linearized transcritical:

\begin{align}
\frac{\ud }{\ud t} E(x_i| M = \text{LTC})&=  r(t)(r(t) - x_i) \\
\frac{\ud}{\ud t} V(x_i| M = \text{LTC}) &=  -2 r(t) V(x_i|M) + (1+r(t))\sigma^2 
\label{LTCsoln}
\end{align}

For the linearized saddle-node bifurcation:
\begin{align}
\frac{\ud }{\ud t} E(x_i| M = \text{LSN})&=  2\sqrt{r(t)}(\sqrt{r(t)}+\theta - x_i) \\
\frac{\ud}{\ud t} V(x_i| M = \text{LSN}) &=  -2 \sqrt{r(t)} V(x_i) + \sigma^2 ( \sqrt{r(t)}+\theta )
\label{LSNsoln}
\end{align}

These are numerically integrated using \texttt{lsoda} routine available in \texttt{R} for the likelihood calculation.  

                           
                             %Appendix text...
                             %% or, for appendix with title, use square brackets:
                             %% \appendix[Appendix Title]

                             \begin{acknowledgments}

Author Contributions
C.B. wrote the software and performed the analysis with advice from A.H.  C.B. and A.H. designed the study and wrote the paper.  

Acknowledgements
S. Schreiber, M. Holyoak, M. Baskett, and A. Perkins provided comments on the manuscript.  This research was supported by funding from NSF Grant EF 0742674 and a Computational Sciences Graduate Fellowship from the Department of Energy grant DE-FG02-97ER25308.

Data and code available at: https://github.com/cboettig/warningsignals/archives/master. 
                             \end{acknowledgments}

                             %% PNAS does not support submission of supporting .tex files such as BibTeX.
                             %% Instead all references must be included in the article .tex document. 
                             %% If you currently use BibTeX, your bibliography is formed because the 
                             %% command \verb+\bibliography{}+ brings the <filename>.bbl file into your
                             %% .tex document. To conform to PNAS requirements, copy the reference listings
                             %% from your .bbl file and add them to the article .tex file, using the
                             %% bibliography environment described above.  

                             %%  Contact pnas@nas.edu if you need assistance with your
                             %%  bibliography.

                             % Sample bibliography item in PNAS format:
                             %% \bibitem{in-text reference} comma-separated author names up to 5,
                             %% for more than 5 authors use first author last name et al. (year published)
                             %% article title  {\it Journal Name} volume #: start page-end page.
                             %% ie,
                             % \bibitem{Neuhaus} Neuhaus J-M, Sitcher L, Meins F, Jr, Boller T (1991) 
                             % A short C-terminal sequence is necessary and sufficient for the
                             % targeting of chitinases to the plant vacuole. 
                             % {\it Proc Natl Acad Sci USA} 88:10362-10366.


                             %% Enter the largest bibliography number in the facing curly brackets
                             %% following \begin{thebibliography}


                             \bibliographystyle{/home/cboettig/Documents/tex/pnas.bst}
                             \bibliography{/home/cboettig/Documents/bibliographies/library.bib}
                           \end{article}
                           %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

                           %% Adding Figure and Table References
                           %% Be sure to add figures and tables after \end{article}
                           %% and before \end{document}

                           %% For figures, put the caption below the illustration.
                           %%
                           %% \begin{figure}
                           %% \caption{Almost Sharp Front}\label{afoto}
                           %% \end{figure}
 \begin{figure*}
   \begin{center}
     \includegraphics[width=\linewidth]{Fig1}
     \label{fig1}
     \caption{Top row: The distributions of a hypothetical warning indicator are shown under the case of a stable system (blue) and a system approaching a critical transition (red).  Bottom row: Points along the ROC curve are calculated for each possible threshold indicated in the top row.  The false positive rate is the integral of the distribution of the test statistic under the stable system right of the threshold (blue shaded area, corresponding to blue vertical line).  The true positive rate is the integral of the system approaching a transition left of the threshold (red shaded area, corresponds to the red line).  Successive columns show the threshold increasing, tracing out the ROC curve (successively gray lines show the threshold used for the matching gray point added to the ROC curve).}
  \end{center}
 \end{figure*}



 \begin{figure*}
   \begin{center}
     \includegraphics[width=\linewidth]{Fig2}
     \label{fig2}
     \caption{Early warning signals in simulated and empirical data sets.  The first two columns are simulated data from (a) a stable system (Stable), and (b) the same system approaching a saddle-node bifurcation due to a gradually deteriorating environment (Deteriorating).  Empirical examples are from (c) \emph{Daphnia magna} concentrations manipulated in a chemostat towards a critical transition (Daphnia), and (d) deuterium concentrations previously cited as an early warning signal of a critical transition in glaciation (Glaciation). Increases in summary statistics such as variance, autocorrelation, or skew, computed over a moving window, are used to indicate if a system is moving towards a critical transition (see supplementary online text).  The increase is measured by the correlation coefficient $\tau$.  Note that positive correlation does not guarantee the system is moving towards a transition, as seen in the stable system, first column.}
  \end{center}
 \end{figure*}



 \begin{figure*}
   \begin{center}
     \includegraphics[width=\linewidth]{Fig3}
     \label{fig3}
     \caption{ROC curves for different early warning indicators on simulated and empirical data.  The area under the curve, inset, indicates how the method compares to a random guess (0.5).  The likelihood method performs substantially better than other metrics, particularly on the weaker trends seen in the empirical data. The simulated dataset has 40 points, ``Daphnia'' has 16, the ``Glaciation'' has 121. See corresponding distributions, Fig. S1, and additional examples, Fig. S2.}
  \end{center}
 \end{figure*}


 \begin{figure*}
   \begin{center}
     \includegraphics[width=\linewidth]{Fig4}
     \label{fig4}
     \caption{ROC curves (from Fig. 3) are recalculated under different sampling frequencies in the simulation step (see supplementary online text), using a total of 25, 50, or 200 points.  Increasing the sampling improves the trade-off between sensitivity and reliability for all indicators, though the likelihood approach is most effective.} 
  \end{center}
 \end{figure*}



                           %% For Tables, put caption above table
                           %%
                           %% Table caption should start with a capital letter, continue with lower case
                           %% and not have a period at the end
                           %% Using @{\vrule height ?? depth ?? width0pt} in the tabular preamble will
                           %% keep that much space between every line in the table.

                           %% \begin{table}
                           %% \caption{Repeat length of longer allele by age of onset class}
                           %% \begin{tabular}{@{\vrule height 10.5pt depth4pt  width0pt}lrcccc}
                           %% table text
                           %% \end{tabular}
                           %% \end{table}

                           %% For two column figures and tables, use the following:

                           %% \begin{figure*}
                           %% \caption{Almost Sharp Front}\label{afoto}
                           %% \end{figure*}

                           %% \begin{table*}
                           %% \caption{Repeat length of longer allele by age of onset class}
                           %% \begin{tabular}{ccc}
                           %% table text
                           %% \end{tabular}
                           %% \end{table*}

                           \end{document}



