%\documentclass[authoryear,5p]{elsarticle}
\documentclass[authoryear,review,12pt]{elsarticle}
\bibliographystyle{elsarticle-harv}
\usepackage{graphicx}
\usepackage{amsmath,amsfonts}
\usepackage{lineno}
\linenumbers
\usepackage{float}
\usepackage{subfigure}
\usepackage[pdftex]{color}
\definecolor{darkblue}{rgb}{0,0,0.5}
\definecolor{darkgreen}{rgb}{0,0.5,0}
\usepackage[pdftex, colorlinks]{hyperref}
\textwidth 6.75in
\oddsidemargin -0.15in
\evensidemargin -0.15in
\textheight 9in
\topmargin -0.5in
\newcommand{\ud}{\mathrm{d}}
\newcommand{\E}{\mathrm{E}}
\newcommand{\C}{\mathrm{Cov}}
\newcommand{\V}{\mathrm{Var}}
\newcommand{\cb}[1]{{\it \color{darkgreen} (#1)}}

%% Redefines the elsarticle footer
\makeatletter
\def\ps@pprintTitle{
\let\@oddhead\@empty
\let\@evenhead\@empty
\def\@oddfoot{\it \hfill\today}
\let\@evenfoot\@oddfoot}
\makeatother



\journal{\tiny } 
\begin{document}
\begin{frontmatter}
  \title{Early Warning Signals and the Prosecutor's Fallacy}
  \author[cpb]{Carl Boettiger\corref{cor1}}
  \ead{cboettig@ucdavis.edu}
  \author[esp]{Alan Hastings}
  %\author[info]{}
  %\author[davis]{}
  \cortext[cor1]{Corresponding author.}
  \address[cpb]{Center for Population Biology, 1 Shields Avenue, University of California, Davis, CA, 95616 United States.}
  \address[esp]{Department of Environmental Science and Policy, University of California, Davis} 

 % \address[info]{ \\ 
  %              }

  \begin{abstract}

  Early warning signals have been proposed to forecast the possibility of a 
  critical transition, such as the eutrophication of a lake, desertification
  of savanna, the collapse of a coral reef, the end of a glacial period, or 
  the onset of epilepsy in the brain.  While such transitions may be difficult
  to study in the laboratory setting and unethical to introduce on the larger
  natural scales where they may occur, it has often been observed that history
  has already performed the experiment for us, time and again.  Here we point 
  out a critical difference between selecting systems for study based on the 
  fact that we have observed a critical transition and those systems for which
  we wish to forecast the approach of a transition. This difference arises
  by conditionally selecting systems known to experience a transition of some 
  sort and failing to account for this selection step -- a statistical error 
  often known as the Prosecutor's
  Fallacy.  We illustrate through simulation how examples of systems that have 
  experienced transitions purely by chance show patterns associated with 
  early warning signals more often than we might expect in systems that have not
  been conditionally selected.  We further highlight how a model-based approach
  is less subject to this bias.  In using historical examples of collapse to 
  test and validate methods for early warning signals, greater care must be taken
  to avoid this fallacy.  Groundbreaking experimental studies with replicates
  avoid this pitfall, and more of such studies are needed to provide data
  suitable for evaluating methods for early warning.  
 
  \end{abstract}

  \begin{keyword}
early warning signals \sep tipping point \sep alternative stable states \sep likelihood methods 
   \end{keyword}
 \end{frontmatter}

\section{Introduction}

\subsection*{Catastrophic Transitions}

Catastrophic transitions or tipping points, where a complex system 
shifts suddenly from one state to another, have been implicated in
a wide array of ecological and global climate systems such as lake
ecosystems~\citep{Carpenter2011}, coral reefs~\citep{Mumby2007},
desertification~\citep{Kefi2007}, fisheries~\citep{Berkes2006}, and 
tropical forests~\citep{Hirota2011}.  Recent research has begun to
identify statistical patterns commonly associated with these sudden
catastrophic transitions which could be used as an \emph{early warning sign}
to identify an approaching tipping point, buying precious time 
to react and avert them~\citep{Scheffer2009, Lenton2011}.  

An array of statistical patterns associated with tipping point phenomena has
been suggested for the detection of early warning signals associated with
such sudden transitions.  Two of the most commonly used are a pattern of
increasing variance~\citep{Carpenter2006} and a pattern of increasing 
autocorrelation~\citep{vanNes2007}, which have been tested in both experimental
manipulation~\citep{Drake2010, Carpenter2011, Veraart2011} and historical 
observations~\citep{Livina2007,Dakos2008,Lenton2012,Ditlevsen2010,Guttal2008,Thompson2010}


\subsection*{Testing patterns on historical data}

Historical examples of sudden transitions taken from the paleoclimate record
provide an important way to test and evaluate potential leading indicator 
methods, and have been widely used for this purpose 
\citep{Livina2007,Dakos2008,Lenton2012,Ditlevsen2010,Guttal2008,Thompson2010}.
Similarly, it has been suggested that data gathered from ecological systems such
as lakes that were monitored before they collapsed, or grasslands subjected to
overgrazing, could contain data that could help reveal when similar systems 
are approaching a tipping point~\citep{Inman2011}.  This is a silver lining to
the clouds of past catastrophes -- we may be able to learn from our mistakes. 

Yet in testing methods for early warning signals against historical examples of
transitions, we must be careful to avoid statistical mistakes that arise when
we select examples conditional on having exhibited a sudden transition.  Such
sudden transitions can occur for many reasons that do not involve the 
bifurcation processes on which most early warning indicators are predicated
~\citep{Hastings2010}, including purely noise-induced transitions for proposed 
early warning patterns are not anticipated~\citep{Ditlevsen2010, Lenton2011}. 
Ignoring the potential biases introduced by conditionally selecting from 
historical records is an example of the statistical error commonly known as the
\emph{Prosecutor's Fallacy.}

\subsection*{The Prosecutor's Fallacy}


In a criminal trial, the prosecution may introduce associative evidence such as 
blood testing to establish a match between the perpetrator at the scene of the
crime and a suspect on the defense stand.  Statistical testimony may accompany 
such evidence reflecting the incidence rate of the matching characteristic -- 
for instance, the frequency of individuals in the population with the matching
blood type.  Such arguments may be misleading when they fail to account for  
the manner in which the suspect was identified in 
the first place.  If the suspect has been selected partly on the basis of 
belonging to a demographic in which the discriminating characteristic is much more common than
in the population as a whole, these odds can be misleading.  Failing to recognize 
these conditional probabilities leads to the Prosecutor's Fallacy: the 
argument that the suspect is the perpetrator on the basis of the statistical 
probability of a match without correctly identifying the baseline probability 
for such a match \citep{Thompson1987}.

% Consider an equation 

\section{Methods and Results}
We approach the problem by simulating a system that cannot undergo the saddle
node bifurcation that underlies the usual early warning signal indicators.  
This simulation approach is the only way to determine whether examining 
historical events is a good way to test the utility of these indicators.
We simulated 1000 replicates of a stochastic individual-based birth-death process
with an Allee threshold~\citep{Courchamp2008}, which arises from positive fitness
effects at low densities.  Above the Allee threshold the population returns
to a positive equilibrium size, while below the threshold the population decreases
to zero in expectation. The simulation uses the Gillespie algorithm to provide an exact 
implementation of the master equation of the birth-death process,

\begin{align}
  \frac{dP(n,t)}{dt} &= b_{n-1} P(n-1,t) + d_{n+1}P(n+1,t) - (b_n+d_n) P(n,t)  \label{master} \\
    b_n &= \frac{e K n^2}{n^2 + h^2} \\
    d_n &= e n + a
\end{align}

a model with a linear death rate and density dependent birth rate that drives
the Allee effect at low densities and limits growth at high densities.  The
key feature of this model is the alternate stable states introduced by this effect;
other functional forms for Eq.~\ref{master} could serve equally well for these
simulations~\citep[see \emph{e.g.}][]{Scheffer2001}. 
Though this system can be forced through a saddle-node bifurcation by
increasing the death rate, in these simulations all parameters
are held constant and no bifurcation occurs.  Consequently we do not 
anticipate an early warning signal of an approaching bifurcation.
The simulation starts from the positive equilibrium population size.
Though the chance of a transition across the Allee threshold in any 
given time step are small, given enough time this system will eventually
experience such a rare event driving the population extinct.  We evolved
each replicate 50,000 time steps, sampling the system every 50 time steps.  
In this time window 266 of the 1,000 replicates experience population collapse.  
To keep the examples of comperable sample size, we focus on a section of the data
500 time points prior to the system approaching the transition.  
Nine of these replicates can be seen in Figure~\ref{fig:replicate_crashes},
as an illustration.   

  \begin{figure}
    \begin{center}
      \includegraphics[width=6in]{replicate_crashes.pdf}
    \end{center}
    \caption{Example trajectories for nine of the 266 replicates that 
             experience a critical transition by chance during the course
             of the simulation, showing the window of 500 points prior to
             crossing the threshold which is used in the analysis.  A wobble
             at the unstable critical point is visible at the end of several 
             trajectories.}
    \label{fig:replicate_crashes}
  \end{figure}


To test whether selecting systems that have experienced spontaneous transitions
could bias the analysis towards false positive detection of early warning signals,
(the Prosecutor's Fallacy) we selected replicates conditional on having collapsed
in the simulations.
We then selected a window around each system that ended just before the
collapse, while the population values were still above the Allee threshold.
For each replicate, we calculated the most common early warning indicators, variance
and autocorrelation~\citep[\emph{e.g.}][]{Carpenter2006,Dakos2008,Scheffer2009}, 
around a moving window equal to half the length of that time series.  


To test for the presence of a warning signal in these indicators we computed
values of Kendall's $\tau$ for both indicators for each of the 266 replicates.
Kendall's $tau$ takes values in $(-1, 1)$, and is frequently used to identify
an increasing trend ($\tau > 0 )$ in early warning signals.~\citep{Dakos2008, Dakos2011}.
indicate an increasing trend in the warning signal.  The distribution of $\tau$ 
values observed across these replicates is shown in Figure~\ref{fig:indicator}.
More positive values indicate stronger trends. The common statistical significance
test used for Kendall's $tau$ assumes independence of the variables to achieve
a normal distribution, this isn't satisfied for indicators coming from a time 
series and computed with a sliding window.  For a more robust comparison, we 
compare the distribution of this statistic from all the simulations to the 
distribution conditioned on experiencing a chance transition to the alternative
stable state, that is, from the replicates which are known to crash.  To avoid 
an effect of sample size the timeseries are all chosen to be the same length.  
As these examples have been selected from a system that is not approaching a 
bifurcation, an indicator that does not suffer from the bias of Prosecutor's fallacy
should have the same distribution in both cases.   Annotated, parallelized code to 
replicate the analysis and produce the figures is provided in the appendix. 
(Currently at \href{https://github.com/cboettig/earlywarning/blob/prosecutor/inst/examples/fallacy.md}{https://github.com/cboettig/earlywarning/blob/prosecutor/inst/examples/fallacy.md}).  


\begin{figure}[H]
  \begin{center}
    \includegraphics[width=6in]{indicators.pdf}
  \end{center}
  \caption{The distribution of the correlation statistic $\tau$ for two early warning indicators (variance, autocorrelation) on replicates conditionally selected for having collapsed by chance in simulations. Positive values of $\tau$ correspond to a pattern of an indicator increasing with time; typically taken as evidence that a system is approaching a critical transition.  In these simulations, the pattern arises instead from the Prosecutor's fallacy of conditional selection.}
  \label{fig:indicator}
\end{figure}




For each of these replicates we also take a model-based approach, estimating 
parameters for an approximate linear model of the system approaching a
saddle node bifurcation.


\begin{equation}
  dX = \sqrt{ r_t } (\phi(r_t) - X_t) dt +
  \sigma\sqrt{\phi(r_t) } d B_t \label{LSN}
\end{equation}
where \( \phi(r_t) = \sqrt{r_t} +\theta \) is the equilibrium position.  
This model emerges from the canonical form of the saddle-node bifurcation,

\begin{equation}
  \frac{dX}{dt} = r - x^2
\end{equation}
where we introduce an explicit parameter $\theta$ to account for rescaling
to the units of the data,

\begin{equation}
   \frac{dX}{dt} = r - (x-\theta)^2
\end{equation}
and then consider the corresponding stochastic process where the noise is
proportional to the square root of the mean, as is the case for demographic
noise processes,

\begin{equation}
  \frac{dX}{dt} = r - (x-\theta)^2 + \sqrt{ \beta (r + (x-\theta)^2 } dB_t
\end{equation}
$r$ remains the bifurcation parameter which we imagine changing with time,
$r_t$, then linearizing the above model in neighborhood of
\(\hat x = \sqrt{r_t} +\theta =: \phi(r_t)\), we recover Equation~\eqref{LSN}.
These models can be both be fit to the data by maximum likelihood estimation
based on the equation for the evolution of their moments, as explained
in~\citet{Boettiger2012b}.  Though this approximation is more general than 
the original Markov process (as other models containing a saddle-node bifurcation
share the same approximation), it is also easier to estimate reliably from 
the data since it describes only the process near the equilibrium where the
data is available.  We assume that $r_t$ is varying at constant rate, 
according to the model

\begin{equation}
 r_t = m t + r_0 
\end{equation}
and estimate $m$, $r_0$, $\theta$, and $\beta$ by maximum likelihood on each
of the simulated datasets.  Estimates of $m < 0 $ are expected in systems 
approaching a bifurcation, while for stable systems $m$ should be approximately zero.


Of the 266 simulations, only six had estimates with machine precision different
from zero, the greatest magnitude among these was $-7.1 \times 10^{-12}$,
which would still correspond to a negligible change in $r_0$ over the 50,000 time steps
of the simulation.  Consequently, the model-based estimation shows no 
evidence of bias on data that has been selected conditional on collapse.   



\section{Discussion}

Historical examples of systems that have undergone sudden transitions seem
to offer an invaluable opportunity to test methods for the detection of
early warning signals that could have forseen the collapse.  However,
such data must be used with care, as the process of selecting systems
already known to have collapsed opens up the possibility that these
transitions were the result of rare chance events rather than examples
of the more deterministic tipping point behaviour we wish to detect.
When we think about forecasting potential collapse in a single system,
these purely-chance transitions may be rare enough to ignore.  When we
comb the historical record for any available data on sudden transitions,
our odds of finding these chance transitions may be much higher.

We have shown that systems which undergo such rare transitions look
statistically different from their counterparts that do not, even though
they are driven by the same stochastic process.  In particular, such
conditionally selected examples are more likely to show signs associated
with an early warning of an approaching tipping point, such as increasing
variance or increasing autocorrelation, as measured by Kendall's $\tau$.
This increases the risk of false positives -- cases in which a warning
signal being tested appears to have successfully detected an oncoming
tipping point, when in fact the example is falsely accused, coming
instead from a stable system. Figure 2 shows the extent of this bias,
where many of the chance crashes show values of $\tau$ that are 
significantly larger than those observed in the otherwise identical
replicates that did not experience a chance transition.  


\subsection{Chance transitions are false positives for early warning signals}

It seems tempting to argue that the bias towards positive detection
in historical examples is valuable -- each of these systems did
indeed collapse, so the fact that they show increased probability
to exhibit warning signals could be taken as a successful detection.
Unfortunately this is not the case. At the moment the forecast is made,
these systems are no more likely to crash than their counterparts from
the sample that did not collapse, just as a fair coin is still a fair
coin after a string of consecutive ``heads.''  Taking a closer look at
the patterns involved we can begin to understand why common indicators
such as autocorrelation and variance can be misleading.

The farther the system gets from its stable point (while still remaining
in the local region), the more likely it is to draw a random step that
returns it towards the stable point, like a spring that is stretched
further and further. Despite this, there is always some probability that
it will move further still, and with enough possible examples to choose
from, we can be sure to see this happen occasionally.  Systems that manage
to extend this random walk far enough to cross the tipping point must do
so rather quickly -- with a string of events moving closer and closer to
the edge.  This pattern, clearly visible before the crashes in each of
the examples in Figure 1, produces a string of observations that appear
more highly autocorrelated (if we are sampling the system frequently
enough to catch the excursion at all) than we observe in the rest of the
fluctuations around the equilibrium.  Yet this autocorrelation comes from
a chance trajectory moving quickly \emph{away} from the stable state,
not from the critical slowing down pattern in the return times to the
stable state which precede a saddle-node bifurcation and motivate the
early warning signal.


This longer than expected excursion results in a higher than expected
variance in that window as well. Both variance and autocorrelation are
calculated using a moving window over the time-series, which allows
the method to pick out a pattern of change as the window moves along
the sequence. If this chance excursion that precedes the crash happens
to fill a significant part of the moving window, the resulting pattern
will tend to show an increase in autocorrelation or variance.  If the
chance excursion is relatively rapid compared to the frequency at which
the system is observed (spacing of the data) or the width of the moving
window, the excursion may not significantly alter the general pattern.
In this way, some of the events in which a crash is observed will
appear to present these statistical patterns of increased variance
or autocorrelation without being harbingers of approaching critical
transitions.


\subsection{Comparing to the model-based method}

In our experiment, the model-based estimate of early warning signals
appears more robust than the summary statistics, producing the same
estimates on both the conditionally selected replicates as on a random 
sample of the replicates.  This is a consequence of the more rigid 
specifications that come with a model-based approach -- the pattern
expected is less general than any increase in variance or autocorrelation,
but instead must be one that matches its approximation of the saddle-node
bifurcation. This observation highlights the difference between the pattern
driving the false positive trends in increasing variance and increasing
autocorrelation and the pattern anticipated in the saddle-node model. This
should not however be taken as evidence that the model-based approach is 
immune to the bias of the Prosecutor's Fallacy. 


The problem we highlight ultimately stems from the difficulty of having
only a single realization with which to examine a complex problem.
The only way to deal with this problem is through replication, as
can be done in an experimental system in laboratory manipulations
such as~\citet{Drake2010, Veraart2011} and at the scale of whole lake
ecosystems in~\citet{Carpenter2011}.  Historical data will not suffice,
more such replicated experiments are needed to test these patterns.



 \section{Acknowledgements}
This research was supported by funding from NSF Grant EF 0742674 to AH
and a Computational Sciences Graduate Fellowship from the Department of Energy grant DE-FG02-97ER25308 to CB. 
 \section{References}%bibliography
 \bibliography{fallacy}
 \end{document}



